{"ast":null,"code":"import _regeneratorRuntime from \"/Users/rgm93/Library/Mobile Documents/com~apple~CloudDocs/Proyectos/Trabajo/SCAPESHIFT/BC/bc_dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/rgm93/Library/Mobile Documents/com~apple~CloudDocs/Proyectos/Trabajo/SCAPESHIFT/BC/bc_dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/rgm93/Library/Mobile Documents/com~apple~CloudDocs/Proyectos/Trabajo/SCAPESHIFT/BC/bc_dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/rgm93/Library/Mobile Documents/com~apple~CloudDocs/Proyectos/Trabajo/SCAPESHIFT/BC/bc_dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport Signature from \"./Signature\";\nimport Policy from \"./Policy\";\nimport { dateISOString, xAmzDate, dateYMD } from \"./Date\";\nimport { throwError } from './ErrorThrower';\n\nvar S3FileUpload =\n/*#__PURE__*/\nfunction () {\n  function S3FileUpload() {\n    _classCallCheck(this, S3FileUpload);\n  }\n\n  _createClass(S3FileUpload, null, [{\n    key: \"uploadFile\",\n    value: function () {\n      var _uploadFile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(file, config) {\n        var fd, key, url, params, data;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // Error Thrower :x:\n                throwError(config, file);\n                fd = new FormData();\n                key = \"\".concat(config.dirName ? config.dirName + \"/\" : \"\").concat(file.name);\n                url = \"https://\".concat(config.bucketName, \".s3.amazonaws.com/\");\n                fd.append(\"key\", key);\n                fd.append(\"acl\", \"public-read\");\n                fd.append(\"Content-Type\", file.type);\n                fd.append(\"x-amz-meta-uuid\", \"14365123651274\");\n                fd.append(\"x-amz-server-side-encryption\", \"AES256\");\n                fd.append(\"X-Amz-Credential\", \"\".concat(config.accessKeyId, \"/\").concat(dateYMD, \"/\").concat(config.region, \"/s3/aws4_request\"));\n                fd.append(\"X-Amz-Algorithm\", \"AWS4-HMAC-SHA256\");\n                fd.append(\"X-Amz-Date\", xAmzDate);\n                fd.append(\"x-amz-meta-tag\", \"\");\n                fd.append(\"Policy\", Policy.getPolicy(config));\n                fd.append(\"X-Amz-Signature\", Signature.getSignature(config, dateYMD, Policy.getPolicy(config)));\n                fd.append(\"file\", file);\n                params = {\n                  method: \"post\",\n                  headers: {\n                    fd: fd\n                  },\n                  body: fd\n                };\n                _context.next = 19;\n                return fetch(url, params);\n\n              case 19:\n                data = _context.sent;\n\n                if (data.ok) {\n                  _context.next = 22;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", Promise.reject(data));\n\n              case 22:\n                return _context.abrupt(\"return\", Promise.resolve({\n                  bucket: config.bucketName,\n                  key: \"\".concat(config.dirName ? config.dirName + \"/\" : \"\").concat(file.name),\n                  location: \"\".concat(url).concat(config.dirName ? config.dirName + \"/\" : \"\").concat(file.name),\n                  result: data\n                }));\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function uploadFile(_x, _x2) {\n        return _uploadFile.apply(this, arguments);\n      }\n\n      return uploadFile;\n    }()\n  }, {\n    key: \"deleteFile\",\n    value: function () {\n      var _deleteFile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(fileName, config) {\n        var fd, url, params, deleteResult;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                fd = new FormData();\n                url = \"https://\".concat(config.bucketName, \".s3-\").concat(config.region, \".amazonaws.com/\").concat(config.dirName ? config.dirName + \"/\" : \"\").concat(fileName);\n                fd.append(\"Date\", xAmzDate);\n                fd.append(\"X-Amz-Date\", xAmzDate);\n                fd.append(\"Authorization\", Signature.getSignature(config, dateYMD, Policy.getPolicy(config)));\n                fd.append(\"Content-Type\", \"text/plain\");\n                params = {\n                  method: \"delete\",\n                  headers: {\n                    fd: fd\n                  }\n                };\n                _context2.next = 9;\n                return fetch(url, params);\n\n              case 9:\n                deleteResult = _context2.sent;\n\n                if (deleteResult.ok) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", Promise.reject(deleteResult));\n\n              case 12:\n                return _context2.abrupt(\"return\", Promise.resolve({\n                  ok: deleteResult.ok,\n                  status: deleteResult.status,\n                  message: \"File Deleted\",\n                  fileName: fileName\n                }));\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function deleteFile(_x3, _x4) {\n        return _deleteFile.apply(this, arguments);\n      }\n\n      return deleteFile;\n    }()\n  }]);\n\n  return S3FileUpload;\n}();\n\nvar uploadFile = S3FileUpload.uploadFile,\n    deleteFile = S3FileUpload.deleteFile;\nexport { uploadFile, deleteFile };\nexport default S3FileUpload;","map":null,"metadata":{},"sourceType":"module"}